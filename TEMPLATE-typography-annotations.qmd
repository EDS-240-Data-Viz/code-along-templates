---
title: "TEMPLATE - typography & annotations"
author: "Your Name"
date: 2026-02-18
toc: true
---

::: {.callout-note}
This template follows the [typography](https://eds-240-data-viz.github.io/course-materials/lecture-slides/SLLIDES-typography.html#/title-slide){target="_blank"} & [annotations](https://eds-240-data-viz.github.io/course-materials/lecture-slides/SLIDES-annotations.html#/title-slide){target="_blank"} slides. Please be sure to cross-reference the slides, which contain important information and additional context!
:::

## Setup 

::: {.callout-note}
## Recall our dumbbell plot from the [amounts / rankings lecture](https://eds-240-data-viz.github.io/course-materials/lecture-slides/SLIDES-amounts-rankings.html#/title-slide){target="_blank"}
Here, we'll focus on adding text and updating our theme and fonts.
:::

```{r}
#| eval: true
#| echo: true
#| warning: false
#| message: false
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                    setup                                 ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#..........................load packages.........................
library(tidyverse)
library(janitor)

#..........................import data...........................
iwa_data <- read_csv(here::here("week7", "data", "combined_iwa-assessment-outputs-conus-2025_CONUS_200910-202009_long.csv"))

#..................create df of subregions names.................
# data only contain HUC codes; must manually join names if we want to include those in our viz (which we do! we'll mainly be looking at CA subregions)
# subregions (& others) identified in: https://water.usgs.gov/GIS/wbd_huc8.pdf
# there may be a downloadable dataset containing HUCs & names out there...but I couldn't find it
subregion_names <- tribble(
  ~subregion_HUC, ~subregion_name,
  "1801", "Klamath-Northern California Coastal",
  "1802", "Sacramento",
  "1803", "Tulare-Buena Vista Lakes",
  "1804", "San Joaquin",
  "1805", "San Francisco Bay",
  "1806", "Central California Coastal",
  "1807", "Southern California Coastal",
  "1808", "North Lahontan", 
  "1809", "Northern Mojave-Mono Lake",
  "1810", "Southern Mojave-Salton Sea",
)

#......................import Google fonts.......................
# `name` is the name of the font as it appears in Google Fonts
# `family` is the user-specified id that you'll use to apply a font in your ggplot

#....................import Font Awesome fonts...................

#......enable {showtext} rendering for all newly opened GDs......

```

## Wrangle data

This is the same code we saw in the [amounts / rankings lecture](https://eds-240-data-viz.github.io/course-materials/lecture-slides/SLIDES-amounts-rankings.html#/title-slide){target="_blank"}.

```{r}
#| eval: true
#| echo: true
#| warning: false
#......create df with just CA water resource region (HUC 18).....
ca_region <- iwa_data |> 
  clean_names() |> 
  mutate(region_HUC = str_sub(string = huc12_id, start = 1, end = 2),
         subregion_HUC = str_sub(string = huc12_id, start = 1, end = 4)) |> 
  filter(region_HUC == "18") |> 
  separate_wider_delim(cols = year_month,
                       delim = "-",
                       names = c("year", "month")) |>                            
  mutate(year = as.numeric(year),
         month = as.numeric(month)) |> 
  left_join(subregion_names) |> 
  select(year, month, huc12_id, region_HUC, subregion_HUC, subregion_name, availab_mm_mo, consum_mm_mo, sui_frac)

#.................create df of just SBC subbasin.................
sbc_subbasin_monthly <- ca_region |> 
  mutate(subbasin_HUC = str_sub(string = huc12_id, start = 1, end = 8)) |> 
  filter(subbasin_HUC == "18060013") |> 
  group_by(month) |> 
  summarize(mean_avail = mean(availab_mm_mo, na.rm = TRUE),
            mean_consum = mean(consum_mm_mo, na.rm = TRUE)) |> 
  mutate(month = month.abb[month],
         month = factor(month, levels = rev(c(month.abb[10:12], month.abb[1:9]))))
```

## Create plot 

We'll build this plot across both the  [typography](https://eds-240-data-viz.github.io/course-materials/lecture-slides/SLLIDES-typography.html#/title-slide){target="_blank"} and [annotations](https://eds-240-data-viz.github.io/course-materials/lecture-slides/SLIDES-annotations.html#/title-slide){target="_blank"} lectures.

```{r}
#| eval: true
#| echo: true
#| warning: false
#| out-width: "100%"
#......................create color palette......................
# colors: #448F9C, #9C7344, #0C1509, #4E514D

#........................preview palette.........................

#..........................create title..........................

#.........................create caption.........................

#........................create annotation.......................

#..............................plot..............................
ggplot(sbc_subbasin_monthly) +
  geom_linerange(aes(y = month,
                     xmin = mean_consum, xmax = mean_avail)) + 
  geom_point(aes(x = mean_avail, y = month), 
             color = "#448F9C", 
             size = 5,
             stroke = 2) +
  geom_point(aes(x = mean_consum, y = month), 
             color = "#9C7344", 
             fill = "white",
             shape = 21,
             size = 5,
             stroke = 2) +
  labs(x = "Mean monthly water availability & consumption (mm)") +
  theme(axis.title.y = element_blank())

#..............enable {showtext} for newly opened GD.............

#...........................print plot...........................

#...............turn off {showtext} text rendering...............
```

## Save plot as a PNG file

```{r}
#| eval: true
#| echo: true
#..............enable {showtext} for newly opened GD.............

#...................set resolution to match GD...................

#..............write plot to file (aka save as png)..............

#...............turn off {showtext} text rendering...............
```

